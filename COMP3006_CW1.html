<!DOCTYPE html>
<html lang="en">
	<head>
		<style>
			body {
				background-color: #99ffff;
				font-family: "Verdana";
			}
			h1 {
				font-size: 36px;
			}
			.day {
				border: 1px solid #000;
				float: left;
				width: 19%;
			}
			.session {
				background: #dfdfdf;
				width: 80%;
				height: 120px;
				margin: 5%;
				padding: 5%;
			}
			.session.active {
				background: #f0fbfc;
			}
			#errors li {
				color: #ff0000;
			}
		</style>
		<title>Timetable Viewer</title>
	</head>
	<body>
		<h1>Timetable Viewer</h1>
		<div id="timetable">
			<div id="mon" class="day">
				<p>Monday</p>
				<div class="session" id="mon_9">
					<p>9am</p>
				</div>
				<div class="session" id="mon_11">
					<p>11am</p>
				</div>
				<div class="session" id="mon_14">
					<p>2pm</p>
				</div>
				<div class="session" id="mon_16">
					<p>4pm</p>
				</div>
			</div>
			<div id="tue" class="day">
				<p>Tuesday</p>
				<div class="session" id="tue_9">
					<p>9am</p>
				</div>
				<div class="session" id="tue_11">
					<p>11am</p>
				</div>
				<div class="session" id="tue_14">
					<p>2pm</p>
				</div>
				<div class="session" id="tue_16">
					<p>4pm</p>
				</div>
			</div>
			<div id="wed" class="day">
				<p>Wednesday</p>
				<div class="session" id="wed_9">
					<p>9am</p>
				</div>
				<div class="session" id="wed_11">
					<p>11am</p>
				</div>
				<div class="session" id="wed_14">
					<p>2pm</p>
				</div>
				<div class="session" id="wed_16">
					<p>4pm</p>
				</div>
			</div>
			<div id="thu" class="day">
				<p>Thursday</p>
				<div class="session" id="thu_9">
					<p>9am</p>
				</div>
				<div class="session" id="thu_11">
					<p>11am</p>
				</div>
				<div class="session" id="thu_14">
					<p>2pm</p>
				</div>
				<div class="session" id="thu_16">
					<p>4pm</p>
				</div>
			</div>
			<div id="fri" class="day">
				<p>Friday</p>
				<div class="session" id="fri_9">
					<p>9am</p>
				</div>
				<div class="session" id="fri_11">
					<p>11am</p>
				</div>
				<div class="session" id="fri_14">
					<p>2pm</p>
				</div>
				<div class="session" id="fri_16">
					<p>4pm</p>
				</div>
			</div>
		</div>
		<h2>Errors</h2>
		<ul id="errors"></ul>
		<button id="display">Display Sessions</button>
		<button id="clear">Clear Sessions</button>
		<script>
			class Session {
				/**
				 * @param {string} title - The title of the session.
				 * @param {Date} sessionTime - The time of the session.
				 * @param {string} staff - The name of the staff member.
				 * @returns {void}
				 * @constructor
				 */
				constructor(title = "", sessionTime = new Date(), staff = "") {
					// The "days" array is used to generate session IDs.
					this.days = ["sun", "mon", "tue", "wed", "thu", "fri", "sat"];

					this.title = title;
					this.sessionTime = sessionTime;
					this.staff = staff;
				}

				/**
				 * Generates a session ID based on the time of the session.
				 * @returns {string} - The session ID.
				 */
				getSessionId() {
					let current = this.sessionTime.getDay();
					let day = this.days[current];
					let hour = this.sessionTime.getHours();
					return `${day}_${hour}`;
				}

				/**
				 * Adds the information regarding the session to the DOM.
				 * @returns {void}
				 */
				renderSession() {
					let id = this.getSessionId();
					let titleID = id + "_title";
					let staffID = id + "_staff";

					// If a session with the same ID exists, then there's a clash.
					if(document.getElementById(titleID)) {
						let error = document.createElement("li");
						let existingTitle = document.getElementById(titleID).textContent;
						error.textContent = existingTitle + " clashes with " + this.title;
						document.getElementById("errors").appendChild(error);
					} else {
						// There are no sessions on Sundays or Saturdays.
						if(["sun", "sat"].includes(this.days[this.sessionTime.getDay()])) {
							let error = document.createElement("li");
							error.textContent = this.title + " is timetabled at an invalid time";
							document.getElementById("errors").appendChild(error);
						} else {
							let titleElement = document.createElement("p");
							titleElement.id = titleID;
							titleElement.textContent = this.title;
					
							let staffElement = document.createElement("p");
							staffElement.id = staffID;
							staffElement.textContent = this.staff;

							let session = document.getElementById(id);

							session.appendChild(titleElement);
							session.appendChild(staffElement);

							session.classList.add("active");
						}
					}
				}

				/**
				 * Removes all sessions currently visible on the timetable.
				 * @returns {void}
				 */
				clearSession() {
					let sessionElement = document.getElementById(this.getSessionId());
					
					if(sessionElement) {
						sessionElement.classList.remove("active");

						let elements = sessionElement.getElementsByTagName("p");

						for(let i = elements.length - 1; i >= 0; i--) {
							if(elements[i].id.includes("_title") || elements[i].id.includes("_staff")){
								elements[i].remove();
							}
						}
					}
				}
			}

			class Timetable {
				/**
				 * @param {Array} sessions - An array of session objects.
				 * @returns {void}
				 * @constructor
				 */
				constructor(sessions = []) {
					this.sessions = sessions;
				}

				/**
				 * Loops through the session objects and calls their "renderSession()" method, which adds their data to the DOM.
				 * @returns {void}
				 */
				displayTimetable() {
					this.clearTimetable();
					this.sessions.map(session => {
						session.renderSession();
					});
				}

				/**
				 * Loops through the session objects and calls their "clearSession()" method, which removes their data from the DOM.
				 * @returns {void}
				 */
				clearTimetable() {
					this.sessions.map(session => {
						session.clearSession();
					});
				}
			}

			let session1 = new Session("COMP3006 Lecture", new Date(2021, 9, 8, 11, 30, 30, 0), "David Walker");
			let session2 = new Session("COMP3005 Lecture", new Date(2021, 9, 8, 11, 30, 30, 0), "Shirley Atkinson");
			let session3 = new Session("COMP3000 Lecture", new Date(2021, 9, 4, 14, 30, 30, 0), "Shirley Atkinson");
			let session4 = new Session("COMP3006 Lab", new Date(2021, 9, 2, 14, 30, 30, 0), "James Hayter");
			let timetable = new Timetable([session1, session2, session3, session4]);

			let buttonDisplay = document.getElementById("display");
			let buttonClear = document.getElementById("clear");

			buttonDisplay.addEventListener("click", () => {
				timetable.displayTimetable();
			});

			buttonClear.addEventListener("click", () => {
				timetable.clearTimetable();
			});
		</script>
	</body>
</html>